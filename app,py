import streamlit as st
from ats_engine import analyze, extract_text_from_pdf

st.set_page_config(
    page_title="ATS Resume Analyzer",
    layout="centered"
)

st.title("ATS Resume Analyzer")

st.write(
    "This tool compares a resume against a job description "
    "and estimates an ATS compatibility score."
)

st.markdown("---")

# Resume upload
st.subheader("Resume")
resume_file = st.file_uploader(
    "Upload resume (PDF)",
    type=["pdf"]
)

# Job description input
st.subheader("Job Description")
jd_text = st.text_area(
    "Paste the job description here",
    height=180
)

st.markdown("---")

if st.button("Analyze"):
    if resume_file is None:
        st.warning("Please upload a resume PDF.")
    elif not jd_text.strip():
        st.warning("Please enter the job description.")
    else:
        with st.spinner("Processing..."):
            with open("temp_resume.pdf", "wb") as f:
                f.write(resume_file.read())

            resume_text = extract_text_from_pdf("temp_resume.pdf")
            result = analyze(resume_text, jd_text)

        st.success("Analysis completed.")

        st.subheader("ATS Score")
        st.write(f"**{result['score']}%**")

        col1, col2 = st.columns(2)

        with col1:
            st.subheader("Matched Skills")
            if result["matched"]:
                for skill in result["matched"]:
                    st.write("-", skill)
            else:
                st.write("No matched skills found.")

        with col2:
            st.subheader("Missing Skills")
            if result["missing"]:
                for skill in result["missing"]:
                    st.write("-", skill)
            else:
                st.write("No missing skills.")

st.markdown("---")
st.caption("ATS Resume Analyzer â€¢ Built using Python and Streamlit")
