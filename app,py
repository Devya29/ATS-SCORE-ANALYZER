import streamlit as st
from ats_engine import analyze, extract_text_from_pdf

st.set_page_config(
    page_title="ATS Resume Score Analyzer",
    page_icon="ğŸ“„",
    layout="centered"
)

st.title("ğŸ“„ ATS Resume Score Analyzer")
st.write(
    "Upload your resume and compare it against a job description "
    "to get an ATS compatibility score."
)

st.divider()

# Upload Resume
st.subheader("ğŸ“¤ Upload Resume")
resume_file = st.file_uploader(
    "Upload resume (PDF only)",
    type=["pdf"]
)

# Job Description Input
st.subheader("ğŸ“ Job Description")
jd_text = st.text_area(
    "Paste the job description here",
    height=200
)

st.divider()

# Analyze Button
if st.button("ğŸ” Analyze Resume", use_container_width=True):

    if resume_file is None:
        st.error("Please upload a resume PDF.")
    elif not jd_text.strip():
        st.error("Please paste the job description.")
    else:
        with st.spinner("Analyzing resume..."):
            # Save uploaded PDF temporarily
            with open("temp_resume.pdf", "wb") as f:
                f.write(resume_file.read())

            resume_text = extract_text_from_pdf("temp_resume.pdf")

            result = analyze(resume_text, jd_text)

        st.success("Analysis complete!")

        # Score Display
        st.metric(
            label="ğŸ“Š ATS Score",
            value=f"{result['score']}%"
        )

        col1, col2 = st.columns(2)

        with col1:
            st.subheader("âœ… Matched Skills")
            if result["matched"]:
                for skill in result["matched"]:
                    st.write(f"- {skill}")
            else:
                st.write("No matched skills found.")

        with col2:
            st.subheader("âŒ Missing Skills")
            if result["missing"]:
                for skill in result["missing"]:
                    st.write(f"- {skill}")
            else:
                st.write("No missing skills!")

st.divider()

st.caption(
    "Built with Python & Streamlit â€¢ ATS-inspired Resume Analyzer"
)
